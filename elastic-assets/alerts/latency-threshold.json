{
  "name": "Order Service - P95 Latency Threshold Alert",
  "tags": [
    "workshop",
    "order-service",
    "latency",
    "threshold"
  ],
  "params": {
    "aggType": "avg",
    "groupBy": "top",
    "termField": "service.name",
    "termSize": 10,
    "thresholdComparator": ">",
    "timeWindowSize": 5,
    "timeWindowUnit": "m",
    "index": [
      "metrics-apm*"
    ],
    "threshold": [
      2000000
    ],
    "searchConfiguration": {
      "query": {
        "query": "service.name:order-service AND transaction.name:\"POST /api/orders\" AND metricset.name:transaction",
        "language": "kuery"
      },
      "index": "metrics-apm*"
    },
    "aggField": "transaction.duration.histogram"
  },
  "consumer": "alerts",
  "schedule": {
    "interval": "1m"
  },
  "rule_type_id": ".index-threshold",
  "notify_when": "onActionGroupChange",
  "actions": [
    {
      "id": "{{SLACK_CONNECTOR_ID}}",
      "group": "threshold met",
      "params": {
        "message": "Order Service latency degradation detected!\n\nP95 latency: {{context.value}}Âµs (threshold: 2000ms)\nTime: {{context.date}}\n\nInvestigate in Kibana: {{context.link}}"
      }
    }
  ],
  "enabled": true
}
